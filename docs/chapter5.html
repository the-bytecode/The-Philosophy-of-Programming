<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 5: True Encapsulation and Authority</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Source+Sans+3:wght@300;400;600&family=Source+Serif+4:ital,wght@0,400;0,600;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Source Sans 3', sans-serif;
            color: #333;
            line-height: 1.6;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
        }
        .content p, .content ul, .content ol {
            font-family: 'Source Serif 4', serif;
            font-size: 1.125rem;
            margin-bottom: 1.5rem;
        }
        .content h2 {
            margin-top: 2.5rem;
            margin-bottom: 1.5rem;
        }
        .content h3 {
            margin-top: 2rem;
            margin-bottom: 1rem;
        }
        .content ul, .content ol {
            margin-left: 1.5rem;
        }
        .content ul {
            list-style-type: disc;
        }
        .content ol {
            list-style-type: decimal;
        }
        .content li {
            margin-bottom: 0.5rem;
        }
        blockquote {
            font-style: italic;
            border-left: 4px solid #8B5CF6;
            padding-left: 1.5rem;
            margin: 2rem 0;
        }
        .chapter-nav a {
            transition: all 0.3s ease;
        }
        .chapter-nav a:hover {
            transform: translateY(-2px);
        }
        .gradient-text {
            background: linear-gradient(45deg, #3B82F6, #8B5CF6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        pre {
            font-family: 'JetBrains Mono', monospace;
            background-color: #f8f9fa;
            border-radius: 0.5rem;
            padding: 1.5rem;
            overflow-x: auto;
            margin-bottom: 1.5rem;
            border: 1px solid #e2e8f0;
        }
        code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            background-color: #f1f5f9;
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
        }
        pre code {
            background-color: transparent;
            padding: 0;
            font-size: 0.85rem;
            color: #1e293b;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-md py-4 sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center">
                <a href="index.html" class="text-xl font-bold text-gray-800 hover:text-indigo-600 transition duration-300">
                    <i class="fas fa-book-open mr-2"></i>Philosophy of Programming
                </a>
                <div class="flex space-x-4">
                    <a href="index.html" class="text-gray-600 hover:text-indigo-600 transition duration-300">
                        <i class="fas fa-home"></i> <span class="hidden md:inline ml-1">Home</span>
                    </a>
                    <a href="chapter6.html" class="text-gray-600 hover:text-indigo-600 transition duration-300">
                        <i class="fas fa-arrow-right"></i> <span class="hidden md:inline ml-1">Next Chapter</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Chapter Header -->
    <header class="bg-gradient-to-r from-blue-50 to-indigo-50 py-20 px-4">
        <div class="max-w-4xl mx-auto text-center">
            <p class="text-indigo-600 font-semibold mb-2">Chapter 5</p>
            <h1 class="text-4xl md:text-5xl font-bold mb-6">True Encapsulation and Authority</h1>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                Move beyond getters and setters to implement authority-based access control that mirrors real-world information sharing.
            </p>
        </div>
    </header>

    <!-- Chapter Navigation -->
    <div class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between py-4 chapter-nav">
                <span class="text-gray-400">
                    <i class="fas fa-book mr-2"></i>Part II: Core Philosophical Principles
                </span>
                <div class="flex space-x-4">
                    <a href="chapter4.html" class="text-gray-600 hover:text-indigo-600 flex items-center">
                        <i class="fas fa-arrow-left mr-1"></i> Previous: Class Impersonation
                    </a>
                    <a href="chapter6.html" class="text-indigo-600 hover:text-indigo-800 flex items-center">
                        Next: Semantic Type Selection <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Chapter Content -->
    <main class="bg-white py-12">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 content">
            <h2 class="text-2xl font-bold" id="beyond-getters-setters">5.1 Beyond Getters and Setters</h2>
            <p>
                Traditional object-oriented programming often reduces encapsulation to a simple formula: make fields private and provide public getters and setters. This mechanical approach misses the deeper philosophical meaning of encapsulation as a tool for enforcing authority boundaries and information hiding.
            </p>
            <p>
                Think about your own personal information in the real world. Would you share your salary details with anyone who asks? Of course not. You might share it with tax authorities because they have a legitimate right to know. You might share it with your spouse or financial advisor out of trust and mutual benefit. But you would likely refuse if a random acquaintance or stranger asked about your income. You instinctively practice information hiding and selective disclosure based on established authority patterns.
            </p>
            <p>
                True encapsulation in programming mirrors this real-world behavior. It goes beyond syntactic privacy to embrace the principle that an object should have authority over its own state and should share information selectively based on real-world authority patterns. Just as you wouldn't put your salary on a public billboard while also refusing to disclose it to the tax authority, our objects shouldn't expose sensitive data to all callers while simultaneously failing to provide it to legitimately authorized entities:
            </p>
            <pre><code>// Conventional encapsulation - mechanical privacy
public class Customer {
    private String name;
    private String taxId;
    private CreditScore creditScore;
    
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }
    public String getTaxId() { return taxId; }
    public void setTaxId(String taxId) { this.taxId = taxId; }
    public CreditScore getCreditScore() { return creditScore; }
    public void setCreditScore(CreditScore creditScore) { this.creditScore = creditScore; }
}

// True encapsulation - authority-based access control
public class Customer {
    private final String name; // Identity - immutable
    private final String taxId; // Sensitive - restricted access
    private CreditScore creditScore; // Controlled by authorized parties
    
    // Identity is accessible to all
    public String getName() {
        return name;
    }
    
    // Tax ID only accessible to tax authorities
    public String getTaxIdForAuthority(TaxAuthority authority) {
        if (authority.isLegitimate()) {
            return taxId;
        }
        throw new UnauthorizedAccessException("Not a legitimate tax authority");
    }
    
    // Credit score only accessible to financial institutions with consent
    public CreditScore getCreditScoreForInstitution(FinancialInstitution institution) {
        if (hasConsentedTo(institution)) {
            return creditScore;
        }
        throw new UnauthorizedAccessException("No consent given to this institution");
    }
    
    // Only credit bureaus can update credit score
    public void updateCreditScore(CreditScore newScore, CreditBureau bureau) {
        if (bureau.isRecognized()) {
            this.creditScore = newScore;
        } else {
            throw new UnauthorizedAccessException("Not a recognized credit bureau");
        }
    }
}</code></pre>
            <p>
                In the second example, the Customer class enforces authority boundaries that reflect real-world rules about who can access or modify different types of information.
            </p>

            <h2 class="text-2xl font-bold" id="selective-disclosure">5.2 Selective Information Disclosure</h2>
            <p>
                True encapsulation recognizes that not all information should be equally accessible to all parties:
            </p>
            <pre><code>public class Medical Record {
    private final Patient patient;
    private final Doctor attendingPhysician;
    private final List&lt;Diagnosis&gt; diagnoses;
    private final List&lt;Prescription&gt; prescriptions;
    private final List&lt;LabResult&gt; labResults;
    
    // Patient can see basic information
    public MedicalSummary getSummaryForPatient() {
        return new MedicalSummary(diagnoses, prescriptions);
    }
    
    // Attending physician can see everything
    public CompleteMedicalRecord getRecordForPhysician(Doctor requestingPhysician) {
        if (requestingPhysician.equals(attendingPhysician) || patient.hasAuthorized(requestingPhysician)) {
            return new CompleteMedicalRecord(diagnoses, prescriptions, labResults);
        }
        throw new UnauthorizedAccessException("Physician not authorized to view this record");
    }
    
    // Insurance companies can see billing-relevant information
    public BillingRecord getRecordForInsurance(InsuranceProvider provider) {
        if (patient.getInsuranceProvider().equals(provider)) {
            return new BillingRecord(diagnoses, prescriptions);
        }
        throw new UnauthorizedAccessException("Not the patient's insurance provider");
    }
}</code></pre>
            <p>
                This Medical Record class provides different views of its information to different parties based on their authority and need-to-know in the real world.
            </p>

            <h2 class="text-2xl font-bold" id="contextual-access">5.3 Contextual Access Control</h2>
            <p>
                True encapsulation implements access control that varies based on the context and the relationship between entities:
            </p>
            <pre><code>public class BankAccount {
    private final Customer owner;
    private final AccountNumber accountNumber;
    private Money balance;
    private List&lt;Transaction&gt; transactions;
    
    // Owner can see everything
    public AccountDetails getDetailsForOwner(Customer requestingCustomer) {
        if (requestingCustomer.equals(owner)) {
            return new AccountDetails(accountNumber, balance, transactions);
        }
        throw new UnauthorizedAccessException("Not the account owner");
    }
    
    // Bank staff can see details for legitimate purposes
    public AccountDetails getDetailsForBankStaff(BankEmployee employee, AccessPurpose purpose) {
        if (employee.hasAccessLevel(AccessLevel.CUSTOMER_ACCOUNTS) && purpose.isLegitimate()) {
            return new AccountDetails(accountNumber, balance, transactions);
        }
        throw new UnauthorizedAccessException("Unauthorized access attempt");
    }
    
    // Regulatory authorities can audit
    public AuditRecord getAuditRecordForRegulator(RegulatoryAuthority authority, AuditRequest request) {
        if (authority.isRecognized() && request.isValid()) {
            return new AuditRecord(accountNumber, transactions);
        }
        throw new UnauthorizedAccessException("Invalid audit request");
    }
}</code></pre>
            <p>
                This approach recognizes that in the real world, access to bank account information depends on who is asking and why.
            </p>

            <h2 class="text-2xl font-bold" id="authority-mutations">5.4 Authority-Based Mutations</h2>
            <p>
                True encapsulation controls not just who can see information but who can change it:
            </p>
            <pre><code>public class Employee {
    private final String name; // Immutable identity
    private Department department; // Can change
    private Money salary; // Sensitive - restricted changes
    
    // Department changes require manager approval
    public void changeDepartment(Department newDepartment, Manager approver) {
        if (approver.canManage(this) || approver.manages(newDepartment)) {
            this.department = newDepartment;
        } else {
            throw new UnauthorizedOperationException("Manager not authorized to make this change");
        }
    }
    
    // Salary changes require HR and management approval
    public void adjustSalary(Money newSalary, HRRepresentative hr, Manager manager) {
        if (hr.isAuthorizedForCompensation() && manager.canManage(this)) {
            this.salary = newSalary;
        } else {
            throw new UnauthorizedOperationException("Insufficient authority for salary adjustment");
        }
    }
}</code></pre>
            <p>
                This Employee class enforces rules about who has the authority to make different types of changes to an employee's record.
            </p>

            <h2 class="text-2xl font-bold" id="designing-with-authority">5.5 Designing with Authority in Mind</h2>
            <p>
                To implement true encapsulation based on authority:
            </p>
            <ol>
                <li><strong>Identify Information Categories</strong>: Classify the information in your domain based on sensitivity and access patterns</li>
                <li><strong>Map Authority Patterns</strong>: Identify who has authority over what information in the real world</li>
                <li><strong>Design Access Methods</strong>: Create contextual access methods that enforce these authority patterns</li>
                <li><strong>Implement Verification</strong>: Add logic to verify the authority of requestors</li>
                <li><strong>Create Appropriate Views</strong>: Return different views of the data based on the requestor's authority</li>
            </ol>
            <p>
                This approach leads to systems that more accurately reflect real-world authority boundaries and information access patterns, resulting in more secure, intuitive, and maintainable code.
            </p>

            <div class="mt-12 pt-6 border-t border-gray-200">
                <blockquote class="italic text-gray-600">
                    "True encapsulation is not just about hiding implementation details; it's about implementing authority-based access control that mirrors how information is shared in the real world."
                </blockquote>
            </div>

            <!-- Chapter Navigation (Bottom) -->
            <div class="mt-12 pt-6 border-t border-gray-200 flex justify-between chapter-nav">
                <a href="chapter4.html" class="text-indigo-600 hover:text-indigo-800 flex items-center">
                    <i class="fas fa-arrow-left mr-2"></i> Previous: Class Impersonation
                </a>
                <a href="chapter6.html" class="text-indigo-600 hover:text-indigo-800 flex items-center">
                    Next: Semantic Type Selection <i class="fas fa-arrow-right ml-2"></i>
                </a>
            </div>
        </div>
    </main>

    <!-- Related Chapters -->
    <section class="py-12 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-bold text-center mb-10">Continue Your Journey</h2>
            <div class="grid md:grid-cols-2 gap-8">
                <a href="chapter4.html" class="bg-white rounded-xl shadow-md hover:shadow-xl p-6 border border-gray-100 transition duration-300 transform hover:-translate-y-1">
                    <div class="flex items-center mb-4">
                        <span class="text-indigo-600 text-lg font-semibold mr-2">Chapter 4:</span>
                    </div>
                    <h3 class="text-xl font-bold mb-2">Class Impersonation</h3>
                    <p class="text-gray-600">Learn to mentally embody the classes you design to create more intuitive and coherent object models.</p>
                </a>
                
                <a href="chapter6.html" class="bg-white rounded-xl shadow-md hover:shadow-xl p-6 border border-gray-100 transition duration-300 transform hover:-translate-y-1">
                    <div class="flex items-center mb-4">
                        <span class="text-indigo-600 text-lg font-semibold mr-2">Chapter 6:</span>
                    </div>
                    <h3 class="text-xl font-bold mb-2">Semantic Type Selection</h3>
                    <p class="text-gray-600">Choose types based on their semantic meaning rather than technical convenience to create more expressive code.</p>
                </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-2xl font-bold mb-4">The Philosophy of Programming</h3>
                    <p class="text-gray-300 mb-4">
                        A profound approach to software development that treats programming as a philosophical discipline.
                    </p>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Chapter Navigation</h3>
                    <ul class="space-y-2">
                        <li><a href="#beyond-getters-setters" class="text-gray-300 hover:text-white transition">5.1 Beyond Getters and Setters</a></li>
                        <li><a href="#selective-disclosure" class="text-gray-300 hover:text-white transition">5.2 Selective Information Disclosure</a></li>
                        <li><a href="#contextual-access" class="text-gray-300 hover:text-white transition">5.3 Contextual Access Control</a></li>
                        <li><a href="#authority-mutations" class="text-gray-300 hover:text-white transition">5.4 Authority-Based Mutations</a></li>
                        <li><a href="#designing-with-authority" class="text-gray-300 hover:text-white transition">5.5 Designing with Authority in Mind</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Navigate</h3>
                    <ul class="space-y-2">
                        <li><a href="index.html" class="text-gray-300 hover:text-white transition">Table of Contents</a></li>
                        <li><a href="chapter4.html" class="text-gray-300 hover:text-white transition">Previous Chapter</a></li>
                        <li><a href="chapter6.html" class="text-gray-300 hover:text-white transition">Next Chapter</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; 2023 The Philosophy of Programming. All rights reserved.</p>
            </div>
        </div>
    </footer>
</body>
</html>